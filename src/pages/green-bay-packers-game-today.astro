---
import { getNextGames } from '@utils/getNextGames';
import Container from "@components/container.astro";
import Layout from "@layouts/Layout.astro";
import { getLangFromUrl, useTranslations } from '../i18n/utils';
import { getSeoMetadata } from '../i18n/seo';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

function isGameToday(gameTime) {
  const gameDate = new Date(gameTime);
  const userTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;

  // Convert game time to user's time zone
  const gameTimeInUserTimezone = new Date(gameDate.toLocaleString('en-US', { timeZone: userTimezone }));

  // Get the current date in the user's time zone
  const now = new Date();

  // Check if the game is happening today in the user's time zone
  const isToday =
    gameTimeInUserTimezone.getDate() === now.getDate() &&
    gameTimeInUserTimezone.getMonth() === now.getMonth() &&
    gameTimeInUserTimezone.getFullYear() === now.getFullYear();

  // Check if the game time has already passed today
  // const hasGameStarted = gameTimeInUserTimezone.getTime() < now.getTime();
  // return isToday && !hasGameStarted;

  return isToday;
}

const { nextGame } = await getNextGames();
const isPlayingToday = nextGame && isGameToday(nextGame.dateOfMatch);
const seo = getSeoMetadata('gameToday', lang);
const yesNoText = isPlayingToday ? (lang === 'pt-BR' ? 'SIM' : 'YES') : (lang === 'pt-BR' ? 'NÃƒO' : 'NO');
---

<Layout
  seoTitle={`${seo.title} ${yesNoText}`}
  seoDescription={seo.description}
  seoOpenGraph={{
    basic: {
      title: `${seo.title} ${yesNoText}`,
      type: "website",
      image: `https://cabecadequeijo.com/og/og-playing-${isPlayingToday ? 'yes' : 'no'}.png`,
      url: seo.ogUrl,
    },
    image: {
      alt: seo.ogAlt,
    },
  }}
>
  <Container>
    <div class="flex flex-col justify-center items-center pt-12 min-h-96">
      <div class="text-3xl font-semibold mb-4">
        {lang === 'pt-BR' ? 'Tem Jogo do Green Bay Packers Hoje?' : 'Is There a Green Bay Packers Game Today?'}
      </div>
      <div class="text-[12rem] font-bold">
        {isPlayingToday ? `ðŸ§€ ${yesNoText} ðŸ§€` : `${yesNoText} ðŸ˜­`}
      </div>
    </div>
  </Container>
</Layout>
